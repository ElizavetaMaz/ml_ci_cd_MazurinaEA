# MLOps HW3 ‚Äî ml_ci_cd_MazurinaEA

## üìå –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç REST‚Äë—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—É—á–µ–Ω–Ω–æ–π ML‚Äë–º–æ–¥–µ–ª–∏ (Wine dataset). –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞:

  * Health ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–∏.
  * Predict ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ –≤–∏–Ω–∞ –ø–æ 13 –ø—Ä–∏–∑–Ω–∞–∫–∞–º.
  * Metrics ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–∑–æ–≤–æ–≤
  * –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ logging, –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
  * –ú–µ—Ç—Ä–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `prometheus_client.Counter`.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

 ml_ci_cd_MazurinaEA/ # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

 ‚îú‚îÄ‚îÄ app/
 
 ‚îÇ    ‚îî‚îÄ‚îÄ main.py # –°–µ—Ä–≤–∏—Å

 ‚îú‚îÄ‚îÄ images/ # –ö–∞—Ä—Ç–∏–Ω–∫–∏ —Å —Ä–∞–±–æ—Ç–æ–π —Å–µ—Ä–≤–∏—Å–∞

 ‚îú‚îÄ‚îÄ models/
 
 ‚îÇ    ‚îî‚îÄ‚îÄ model.pkl # –û–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

 ‚îú‚îÄ‚îÄ .dockerignore # —Ñ–∞–π–ª –æ–ø–∏—Å–∞–Ω–∏—è, —á—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å

 ‚îú‚îÄ‚îÄ Dockerfile # –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞

 ‚îú‚îÄ‚îÄ README.md # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
 
 ‚îú‚îÄ‚îÄ docker-compose.blue.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Blue-–≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–∞
 
 ‚îú‚îÄ‚îÄ docker-compose.green.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Green-–≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–∞

 ‚îú‚îÄ‚îÄ docker-compose.nginx.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ Nginx –º–µ–∂–¥—É Blue –∏ Green

 ‚îú‚îÄ‚îÄ nginx.conf # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è Nginx
 
 ‚îú‚îÄ‚îÄ requirements.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏–º
 
 ‚îî‚îÄ‚îÄ –î–ó3.ipynb # –ù–æ—É—Ç–±—É–∫ —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –º–æ–¥—É–ª—è 3 ¬´–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é CI/CD¬ª.
–ù–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (Blue-Green –∏ Canary) –¥–ª—è ML-–º–æ–¥–µ–ª–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ CI/CD (GitHub Actions).

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç:

  * —É–º–µ–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –∏ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π;
  * —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–µ–ø–ª–æ—è;
  * –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π –∏ —É–º–µ–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç–∫–∞—Ç;
  * –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ /health –∏ –º–µ—Ç—Ä–∏–∫–∏.

## üöÄ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ Blue-Green Deployment.
–¥–ª—è —ç—Ç–æ–≥–æ –±—ã–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã 2 docker-compose:

  - docker-compose.blue.yml
  - docker-compose.green.yml

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ nginx.
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥–æ:
  - –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: git clone https://github.com/ElizavetaMaz/ml_ci_cd_MazurinaEA
  - –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: cd ml_ci_cd_MazurinaEA
  - –∑–∞–ø—É—Å—Ç–∏—Ç—å docker-compose: docker compose -p dz3_ml_in_prodaction -f docker-compose.blue.yml -f docker-compose.green.yml -f docker-compose.nginx.yml up -d
  - –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞:
    * http://localhost:8090/health - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
    * http://localhost:8080/health - blue-—Å–µ—Ä–≤–∏—Å
    * http://localhost:8081/health - green-—Å–µ—Ä–≤–∏—Å
   
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –≤–≤–µ—Å—Ç–∏: curl http://localhost:8090/health     

## üåê –†–∞–±–æ—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞
–¢–∞–∫–∂–µ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∞–¥—Ä–µ—Å—É: https://ml-ci-cd-mazurinaea.onrender.com/health (–Ω—É–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ /predict:
  * PowerShell: Invoke-RestMethod -Uri "https://ml-ci-cd-mazurinaea.onrender.com/predict" `       
    -Method Post `
    -ContentType "application/json" `
    -Body '{"x":[13.2,2.77,2.51,18.5,98.0,2.2,2.4,0.26,1.77,5.0,1.05,3.33,820]}'
  * Bash: curl https://ml-ci-cd-mazurinaea.onrender.com/predict -d '{"x":[13.2,2.77,2.51,18.5,98.0,2.2,2.4,0.26,1.77,5.0,1.05,3.33,820]}'

## üì∑ –§–æ—Ç–æ —Ä–∞–±–æ—Ç—ã
![–ó–∞–ø—É—Å–∫ Docker‚Äë–æ–±—Ä–∞–∑–∞](images/Docker_screenshot.png)

![–ó–∞–ø—É—Å–∫ Docker Compose](images/Docker_compose_screenshot.png)

![–ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ /health](images/Health_screenshot.png)

![–ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ /predict](images/Predict_screenshot.png)
